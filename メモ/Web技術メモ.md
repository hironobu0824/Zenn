## 歴史
- WWW（World Wide Web）の誕生
  - 1989年 欧州原子核研究機構(CERN)で、研究結果の共有のためにティムバーナーズ=リーが発明。
- ブラウザの普及
  - 1993年 イリノイ工科大のNCSA所属のマーク・アンドリーセンが NCSA Mosaic というWebブラウザを開発
  - 研究者の間でしか使われていなかったブラウザが一般の人に普及

- WebサーバとWebクライアント
  - リクエストとレスポンス
  - Webサーバ用のソフトウェア
    - Apache、IIS

- URL
  - インターネット上のコンテンツを一意に指定するための仕組み
  - 例) https://littleforest.jp/webtext/index.html
  - https スキーム
    - リソースを取得するための方法
    - https は暗号化されたhttp通信を表す
  - littleforest.jp ホスト名
    - 処理した結果を返すホストコンピュータの名前
    - www ローカル名 wwwサーバというコンピュータ
    - littleforest.jp 親ドメイン名　日本のlittleforestという組織

- HTTP 
  - 通信プロトコル
  - 決め事

- CGI
  - Common Gateway Interface
  - 動的コンテンツを作るための、Webサーバとコンテンツを生成するプログラムとの連携の仕組み
  - Webサーバがクライアントから受け取ったリクエストをプログラムに渡し、プログラムがリクエストをもとにHTMLを生成
  - サーバサイドの言語で行う仕組みと同義？
  - 問題点
    - Perlが大規模開発に向いていなかった
    - リクエストのたびにプロセスを起動させる必要があり、速度に課題。

- サーブレット
  - Javaで記述する。大規模に向いてる。
  - Webコンテナの内部で実行できる
  - どのOSでも動く
  - 問題点
    - Webコンテナの設置が難しい
    - プログラムにHTMLを形になるため、複雑になる。また、プログラマとデザイナの分担が難しい
  
- JSP
  - Java Server Pages
  - HTMLにJavaのコードを埋め込む形

- Webアプリケーションフレームワーク
  - 大規模になるにつれ、コーディング量が膨大になることを、部品の再利用をすることで避けることができる。



## HTTPを知る

- リクエスト
  - リクエストライン（１行目）
    - `GET http://www.littleforest.jp/webtext/http/index.html HTTP/1.1`
    - メソッド：GET
    - URL
  - メッセージヘッダ（2行目以降）(付加情報）
    - Accept
      - Webクライアントが受け取ることのできるデータの種類
    - Accept-Language
      - Webクライアントが受け取ることができる自然言語（人間が使用する言語）
    - User-Agent
      - 利用しているWebブラウザの種類やバージョン
      - PCやスマホなど
    - Host
      - リクエストの送信先ホスト名やポート番号を指定する

- レスポンス
  - ステータスライン
    - `HTTP/1.1 200 OK`
    - HTTPバージョンとステータスコードとレスポンスフレーズ
  - メッセージヘッダ
    - リクエストと同じ。付加情報
  - メッセージボディ
    - HTMLファイルの内容など

HTTPでは一度のリクエストで1つのリソースしか取得できないため、画像を多く含む画面では画像の数だけHTTPリクエストが発行される

インターネットに接続された全てのコンピュータはIPアドレスによって識別される.
IPアドレスをもとに宛先に情報を届ける仕組み（プロトコル）がTCP/IP
パケットと呼ばれる小さな単位で分割して送信する。

グローバルIPアドレスとプライベートIPアドレス

DNS ホスト名をIPアドレスに変換する
DNSサーバは階層的に分散管理されている。
jpやcom、net,orgなどの最上位のドメインをトップレベルドメイン（TLD）という。TLDのDNSサーバの大元がルートサーバ
ルートサーバは世界に13個存在している

ポート番号
- どのアプリケーションで処理するべきかを指定する番号
- HTTPプロトコルだと80番など、標準で使うポートを決めておくことでポート番号は省略できる。

GETメソッドとPOSTメソッド
- GET
  - パラメータはURLのクエリパラメータに渡す
  - セキュリティは低い
  - 同じ要求を何度繰り返しても同じ結果が得られる（副作用がない）
- POST
  - パラメータはメッセージボディに書かれる
  - セキュリティは高い
  - URLで共有などできない



## 4
リダイレクト
一度302のレスポンスが返る
ブラウザは302を受け取るとLocationヘッダで示されるURLに再度リクエストする

- PHPはなぜ動くか
PHPはWebサーバのソフトであるAppacheの中のモジュールとして組み込まれている。
AppacheがHTMLの中の`<?php ~ ?>`の中だけPHPとして実行する。

Cookie
- Webブラウザに状態を持たせる技術
- WebサーバからCookieを受け取ったWebブラウザは、次回同じWebサーバにアクセスする際、Cookieを送る。
- 違うWebサーバにはそのCookieは送らない

ログイン中はCookieにログイン情報をもたせ、ログアウトするときにCookieを消す

Cookieは比較的簡単に見ることができてしまう

Session
- 受付番号を利用した窓口対応に似ている
- 一連の処理の流れをセッションと呼ぶ
- 受付番号はセッションID
- セッションIDをCookieでやり取りする
- WebサーバはセッションIDとユーザー情報を紐づけて管理する


## 5
- コンピュータをノードと呼ぶ
- データベースサーバーの登場
- データベース管理システム（DBMS）:データベースを扱うソフトウェア
- RDBMS（リレーショナルDBMS）：ほとんどのDBMSがこれになった
- Webサーバ、アプリケーションサーバ、DBサーバの三層構造
  - PHPユーザーだと分かりづらい？
- WebサーバのAppacheとアプリケーションサーバのTomcatの連携方法など。
  - 連携モジュールは「mod_jk」
  - Javaでの説明なので慣れてないと難しい

## 6
- リダイレクトとフォワードの違い
  - リダイレクトはHTTPリクエストが2回行われるが、フォワードはアプリケーションサーバないで遷移するためHTTPリクエストは1回。
- リクエストスコープ
  - フォワード元とフォワード先の間での情報共有の仕組み
  - セッションよりもメモリを有効活用するため
  - リクエストが届いてからレスポンスを返すまでのみ有効
  - アプリケーションサーバが制御
  - ページ遷移前後の情報保持
- セッションスコープ
  - 複数のリクエストにまたがって有効
  - セッションを開始してから、終了かタイムアウトするまで有効
  - Webアプリケーションが制御
  - ユーザ情報の保持
- アーキテクチャ
  - ロジックとデザインの分離
  - IPO（Input、Process、Output）の３つが処理の基本
  - MVC
    - モデル：処理の部分（Process）
    - ビュー：画面表示の部分（Output）
    - コントローラ：入力を受け取り、モデルを呼び出して処理する。その結果をビューに渡す。
  - Layers
    - システムを階層化し、上位レイヤが下位レイヤの提供する機能を利用することで、各レイヤの作りを単純化していく考え方
    - 上位レイヤは下位レイヤを意識する必要がない。
    - プレゼンテーション層：利用者とのインターフェース
    - ビジネスロジック層
    - データアクセス層：ビジネスロジック層とデータベースの仲立ち
    - コントローラとビューがプレゼンテーション層、モデルがビジネスロジック層とデータアクセス層
- フレームワーク
  - 共通部分をまとめてくれてる
  - Struts：Javaのフレームワーク
  - メリット
    - 設計・開発工数の削減
    - 品質の向上
    - テスト工数の削減
  - デメリット
    - 学習コストの増大
    - 設計における自由度低下
    - 長期的な技術力低下

- モデルのビジネスロジック層とデータアクセス層の分離を実現するのがDAO（Data Access Object）
- O/R マッピングフレームワーク
  - データベースへのアクセスを簡単にする。
  - プログラミング言語のオブジェクトとリレーショナルデータベースの対応を取る
  - インピーダンスミスマッチ
    - リレーショナルデータベース上の表現とオブジェクト指向言語におけるオブジェクトの表現の違い
  - インピーダンスミスマッチを解決するのがORマッパ


## 7
セキュリティ
- 機密性
  - 第三者への情報の流出を防ぐこと
- 完全性
  - 第三者による情報の改竄を防ぐこと
- 可用性
  - 適切な権限を持った人間が適切な情報を利用できること

- SQLインジェクション
  - or 1 = 1 のようなSQLを書き込む攻撃
  - 対策  
    - バリデーション、半角英数字のみにするなど
  - プリペアード・ステートメント
    - 変数を後から差し替える
- クロスサイトスクリプティング
  - HTMLの中に悪意のあるJSを埋め込むこと
  - 対策
    - サニタイジング：JavaScriptを含む文字列を、特殊文字を文字参照することで無害化すること
      - 文字参照：文書中に（ある特定の）文字を直接記すことが難しい場合に、特定の英数字や記号の組み合わせを代わりとして用いることができる記法 
      - PHPだと、htmlspecialchars
- セッションハイジャック
  - セッションを盗み取ること
  - 対策
    - クロスサイトスクリプティング対策
    - SSLによって通信路を暗号化する
    - 重要な情報を扱うWebアプリケーションでは、セッションタイムアウトを短めに設定する。
    - セッションIDのランダム化（勝手にやってくれるが、シンプルな文字列は避ける）
- クロスサイトリクエストフォージェリ（CSRF）
  - 攻撃者が捏造したフォームから強制的に情報をサブミットする攻撃
  - 成功してしまう原因は、正規のWebサーバ以外が生成したフォームからサブミットできてしまう点。
  - アプリケーションサーバはブラウザでフォームを表示するときに、ワンタイムトークンをhiddenで埋め込む。そのワンタイムトークンを照合して、自分の生成したサーバのformから送られているかを確認する。
- 強制ブラウズ
  - URLを直叩きして、サーバ内の公開されていない領域にあるファイルやディレクトリを表示させる攻撃
- ディレクトリトラバーサル
  - 公開ファイルがあるディレクトリから非公開ファイルのディレクトリに横断し不正に閲覧する攻撃。
  - 相対パスで指定してアクセスする。
  - 対策
    - ユーザーが入力するパラメータをファイル名として使用しない。

- basic認証
  - ブラウザ入力したユーザ名とパスワードが暗号化されずに送信されてしまう。
- Digest認証
  - ハッシュ関数を使用。

#### 誤動作を防ぐ
- ブラウザバック
  - ブラウザのキャッシュをもとに遷移するから余計なリクエストを行わない。
  - 注文後にブラウザバックしてまた注文ボタンを押すと、重複してしまう。
  - 対策
    - キャッシュを無効化する。
    - JSによって戻るボタンを無効化（非推奨）
    - ワンタイムトークンの利用
      - 同じトークンが送られるので、すでに注文してあることがわかる。
      - 
- ダブルサブミット
  - 遷移に時間がかかるときに、送信ボタンを何回か押してしまうこと。
  - 対策
    - JSによる対策（クリックしたらフラグでtrueを持ち、その後のクリックを無効に）
    - ワンタイムトークン
      - 同じトークンが送られるので、すでに注文してあることがわかる。
- hidden値 
  - 



- Javaに慣れていない人は、細かい記法については無視して、根幹の仕組みを捉えるよう意識。












一度目は注釈やコラムを読まずに一読

第二章のCGIなどが後の章で登場する